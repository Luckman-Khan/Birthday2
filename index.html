<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>Birthday Reveal</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      overflow: hidden;
      touch-action: none;
      background: black;
    }

    img {
      user-select: none;
      -webkit-user-drag: none;
      background-color: transparent !important;
    }

    /* Hide app until ready */
    .app-hidden {
      visibility: hidden;
    }

    @media (orientation: landscape) {
      .portrait-only { display: none; }
      .landscape-message { display: flex; }
    }

    @media (orientation: portrait) {
      .landscape-message { display: none; }
    }
  </style>
</head>
<body>

  <!-- Landscape Warning -->
  <div class="landscape-message hidden md:flex items-center justify-center h-screen text-white text-xl">
    Please rotate to portrait mode ðŸ“±
  </div>

  <!-- App (hidden initially) -->
  <div id="app" class="portrait-only relative w-full h-screen overflow-hidden app-hidden">

    <!-- Background -->
    <img
      src="./assets/background.jpg"
      class="absolute inset-0 w-full h-full object-cover"
      style="z-index:0; pointer-events:none; transform:translateZ(0);"
      alt="Background"
    />

    <!-- Papers -->
    <div id="papers-container" class="absolute inset-0"></div>
  </div>

  <script>
    const papers = [
      { src: './assets/paper1.png', z: 5, x: 0,   y: -90, scale: 1.1, rotation: -4 },
      { src: './assets/paper2.png', z: 4, x: -28, y: 90,  scale: 1.1, rotation: 6  },
      { src: './assets/paper3.png', z: 3, x: 40,  y: 62,  scale: 1.1, rotation: -7 },
      { src: './assets/paper4.png', z: 2, x: -50, y: -26, scale: 1.9, rotation: 5  },
      { src: './assets/paper5.png', z: 1, x: 14,  y: -95, scale: 1.4, rotation: -6 }
    ];

    const container = document.getElementById('papers-container');
    const app = document.getElementById('app');

    let activePaper = null;
    let startX = 0;
    let startY = 0;

    /* ðŸ”‘ Preload all paper images first */
    function preloadImages(srcs) {
      return Promise.all(
        srcs.map(src => new Promise(resolve => {
          const img = new Image();
          img.src = src;
          img.onload = resolve;
          img.onerror = resolve;
        }))
      );
    }

    preloadImages(papers.map(p => p.src)).then(() => {
      // Create papers ONLY after preload
      papers.forEach(p => {
        const img = document.createElement('img');

        img.src = p.src;
        img.style.position = 'absolute';
        img.style.top = '50%';
        img.style.left = '50%';
        img.style.width = '40%';
        img.style.zIndex = p.z;

        img.style.willChange = 'transform';
        img.style.backfaceVisibility = 'hidden';
        img.style.transformOrigin = 'center center';

        img.baseTransform =
          `translate(-50%, -50%) translate(${p.x}px, ${p.y}px) rotate(${p.rotation}deg) scale(${p.scale})`;

        img.style.transform = img.baseTransform;

        img.addEventListener('pointerdown', e => {
          e.preventDefault();
          activePaper = img;
          startX = e.clientX;
          startY = e.clientY;
          img.style.filter = 'drop-shadow(0 10px 20px rgba(0,0,0,0.3))';
        });

        container.appendChild(img);
      });

      // ðŸ”¥ Reveal app ONLY after papers are ready
      app.classList.remove('app-hidden');
    });

    document.addEventListener('pointermove', e => {
      if (!activePaper) return;

      const dx = e.clientX - startX;
      const dy = e.clientY - startY;

      activePaper.style.transform =
        `${activePaper.baseTransform} translate(${dx}px, ${dy}px) scale(1.04)`;
    });

    document.addEventListener('pointerup', () => {
      if (!activePaper) return;
      activePaper.style.filter = '';
      activePaper = null;
    });

    document.addEventListener('contextmenu', e => e.preventDefault());
  </script>

</body>
</html>
